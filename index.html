<script>
async function consultarVehiculo() {
    const input = document.getElementById('plateInput');
    const plate = input.value.trim().toUpperCase().replace(/[-\s]/g, "");
    if (!plate) return;

    const loader = document.getElementById('loader');
    const results = document.getElementById('resultsContent');
    const desc = document.getElementById('resDescription');
    const sub = document.getElementById('resSub');

    loader.classList.remove('hidden');
    results.classList.add('hidden');

    try {
        // Llamada a TU backend
        const response = await fetch(`http://localhost:3000/api/${plate}`);

        if (!response.ok) {
            throw new Error("MATRÍCULA NO ENCONTRADA");
        }

        const res = await response.json();
        const d = res.data || res;

        document.getElementById('resPlate').innerText = plate;
        document.getElementById('resMake').innerText = (d.marca || d.brand || "---").toUpperCase();
        document.getElementById('resModel').innerText = (d.modelo || d.model || "---").toUpperCase();

        let fecha = d.fecha_matriculacion || d.year || "---";
        const anioMatch = String(fecha).match(/\d{4}/);
        document.getElementById('resYear').innerText = anioMatch ? anioMatch[0] : "---";

        document.getElementById('resPower').innerText = (d.potencia || d.cv || "---") + " CV";
        document.getElementById('resFuel').innerText = (d.combustible || "---").toUpperCase();
        document.getElementById('resEngine').innerText = (d.cilindrada || "---") + " CC";

        desc.innerText = "VEHÍCULO LOCALIZADO";
        desc.classList.remove('text-red-500');
        sub.innerText = "Datos obtenidos correctamente";

    } catch (err) {
        document.getElementById('resPlate').innerText = "AVISO";
        desc.innerText = err.message;
        desc.classList.add('text-red-500');
        sub.innerText = "Verifica la matrícula.";

        ['resMake','resModel','resYear','resPower','resFuel','resEngine']
            .forEach(id => document.getElementById(id).innerText = "---");
    }

    loader.classList.add('hidden');
    results.classList.remove('hidden');
}
</script>
